<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ø°ÙƒÙŠØ©</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: row;
        height: 100vh;
      }
  
      .sidebar {
        width: 250px;
        background: #dcd3d3;
        padding: 15px;
        display: flex;
        flex-direction: column;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      }
  
      .service-btn {
        display: flex;
        align-items: center;
        background: white;
        border: none;
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        text-align: left;
        transition: background 0.3s;
      }
      
      .service-btn:hover {
        background: #e0e0e0;
      }
  
      .service-btn span {
        margin-right: 10px;
        font-size: 20px;
      }
  
      #map {
        flex: 1;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <h2>Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
      <button class="service-btn" id="healthBtn"><span>ğŸ¥</span>Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØµØ­ÙŠØ©</button>
      <button class="service-btn" id="educationBtn"><span>ğŸ«</span>Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</button>
      <button class="service-btn" id="commercialBtn"><span>ğŸ›’</span>Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</button>
      <button class="service-btn" id="routeBtn"><span>ğŸš—</span>Ø£ÙØ¶Ù„ Ø·Ø±ÙŠÙ‚</button>
      <button class="service-btn" id="addPointBtn"><span>â•</span>Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø©</button>
    </div>
    <div id="map"></div>
  <script>
    // 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    const map = L.map('map').setView([30.0444, 31.2357], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    let startMarker = null;
    let endMarker = null;
    let routeLayer = null;
    let serviceMarkers = [];

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø±ÙƒØ±
    const createDraggableMarker = (latlng, popupText) => {
      return L.marker(latlng, { draggable: true })
        .bindPopup(popupText)
        .addTo(map);
    };

    // Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©
    map.on('click', (e) => {
      if (!startMarker) {
        startMarker = createDraggableMarker(e.latlng, 'ğŸš¦ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©');
      } else if (!endMarker) {
        endMarker = createDraggableMarker(e.latlng, 'ğŸ Ù†Ù‚Ø·Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©');
      }
    });

    // 2. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù…Ù† Overpass API
    const fetchServices = (serviceType) => {
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø§Ø±ÙƒØ±Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
      serviceMarkers.forEach(marker => map.removeLayer(marker));
      serviceMarkers = [];

      let overpassQuery = '';
      let emoji = '';
      switch (serviceType) {
        case 'health':
          overpassQuery = `[out:json];node["amenity"="hospital"](around:5000,30.0444,31.2357);out;`;
          emoji = 'ğŸ¥';
          break;
        case 'education':
          overpassQuery = `[out:json];node["amenity"="school"](around:5000,30.0444,31.2357);out;`;
          emoji = 'ğŸ«';
          break;
        case 'commercial':
          overpassQuery = `[out:json];node["shop"](around:5000,30.0444,31.2357);out;`;
          emoji = 'ğŸ›’';
          break;
        default:
          return;
      }

      const overpassUrl = `https://overpass-api.de/api/interpreter?data=${encodeURIComponent(overpassQuery)}`;

      fetch(overpassUrl)
        .then(response => response.json())
        .then(data => {
          data.elements.forEach(element => {
            const marker = L.marker([element.lat, element.lon])
              .bindPopup(`${emoji} ${element.tags.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}`)
              .addTo(map);
            serviceMarkers.push(marker);
          });
        })
        .catch(error => console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error));
    };

    // 3. ØªØ­Ù„ÙŠÙ„: Ø£ÙØ¶Ù„ Ø·Ø±ÙŠÙ‚
    document.getElementById('routeBtn').onclick = () => {
      if (!startMarker || !endMarker) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†Ù‚Ø·ØªÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©!');
        return;
      }
      const startCoords = startMarker.getLatLng();
      const endCoords = endMarker.getLatLng();

      const routeUrl = `https://router.project-osrm.org/route/v1/driving/${startCoords.lng},${startCoords.lat};${endCoords.lng},${endCoords.lat}?overview=full&geometries=geojson`;

      fetch(routeUrl)
        .then(response => response.json())
        .then(data => {
          const routeCoordinates = data.routes[0].geometry.coordinates.map(coord => [coord[1], coord[0]]);
          if (routeLayer) map.removeLayer(routeLayer);
          routeLayer = L.polyline(routeCoordinates, { color: 'blue', weight: 4 }).addTo(map);
        })
        .catch(error => console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error));
    };

    // 4. Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ù…Ø®ØµØµØ©
    document.getElementById('addPointBtn').onclick = () => {
      map.once('click', (e) => {
        const customMarker = createDraggableMarker(e.latlng, 'ğŸ“ Ù†Ù‚Ø·Ø© Ù…Ø®ØµØµØ©');
        customMarker.on('click', () => {
          alert('ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ù…Ø®ØµØµØ©');
        });
      });
      alert('Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ù…Ø®ØµØµØ©.');
    };

    // 5. Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø®Ø¯Ù…Ø§Øª
    document.getElementById('healthBtn').onclick = () => fetchServices('health');
    document.getElementById('educationBtn').onclick = () => fetchServices('education');
    document.getElementById('commercialBtn').onclick = () => fetchServices('commercial');
  </script>
</body>
</html>

